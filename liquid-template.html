<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="liquid-import.html">


<polymer-element name="liquid-template" attributes="data">
  <template>

  </template>

  <script>
    Polymer('liquid-template', {
      data: {},
      domReady: function () {

      },
      render: function () {
        try {
          var src = this.innerHTML.trim();
          if (!src) return;

          var tmpl = Liquid.parse(src);

          var html = tmpl.render(this.data);

          //this.shadowRoot.innerHTML = html;            

          // based on code from injectBoundHTML
          var template = document.createElement('template');
          template.innerHTML = html;
          var fragment = this.instanceTemplate(template);
          this.shadowRoot.textContent = '';
          this.shadowRoot.appendChild(fragment);
          
        } catch (ex) {
          var em = 'Exception caught liquid-template.render: ' + (ex.stack || ex);
          console.log(em);
          var emdiv = document.createElement('div');
          emdiv.innerHTML = em ;
          this.shadowRoot.appendChild(emdiv);
        }
      },
      dataChanged: function () {
        
        this.render();

      },
      ready: function () {

      }
    });
  </script>
</polymer-element>
